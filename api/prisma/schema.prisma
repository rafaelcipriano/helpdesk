generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum CallStatus {
  OPEN
  IN_PROGRESS
  CLOSED
}

enum ServiceStatus {
  AVAILABLE
  UNAVAILABLE
}

model Administrator {
  id       String  @id @default(uuid())
  role     String  @default("ADMIN")
  name     String
  email    String  @unique
  password String
  avatar   String?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("administrators")
}

model Technician {
  id           String   @id @default(uuid())
  role         String   @default("TECHNICIAN")
  name         String
  email        String   @unique
  password     String
  openingHours String[] @map("opening_hours")
  avatar       String?

  calls        Call[]

  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  @@map("technicians")
}

model Customer {
  id       String  @id @default(uuid())
  role     String  @default("CUSTOMER")
  name     String
  email    String  @unique
  password String
  avatar   String?

  calls Call[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("customers")
}

model Call {
  id           String     @id @default(uuid())
  title        String
  description  String
  status       CallStatus @default(OPEN)
  price        Decimal @db.Money
  customerId   String
  technicianId String

  customer    Customer   @relation(fields: [customerId], references: [id])
  technician  Technician @relation(fields: [technicianId], references: [id])

  services    Service[] @relation("calls_has_services")

  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("calls")
}

model Service {
  id        String @id @default(uuid())
  name      String
  price     Decimal @db.Money
  status    ServiceStatus @default(UNAVAILABLE)

  call      Call[] @relation("calls_has_services")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("services")
}